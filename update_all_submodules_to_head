#!/bin/bash
#
# Updates all included submodules to the recent COMMIT
# See http://stackoverflow.com/questions/1030169/git-easy-way-pull-latest-of-all-submodules
# and ... http://woss.name/2008/04/09/using-git-submodules-to-track-plugins/
#
# Short version:
# Unlike svn:externals "git submodule" adds a submodule AT A SPECIFIC commit. There's no auto-update!
#

# First update all submodules to HEAD
git submodule foreach git pull origin master

# Commit
git add home/.vim/bundle/*
git commit -am "Updated submodules to the newest version as of `date`" 

# Compile YouCompleteMe if neccessary
if [[ home/.vim/bundle/YouCompleteMe/cpp/ycm/ycm_core.cpp -nt home/.vim/bundle/YouCompleteMe/python/ycm_core.so ]]; then 
  echo
  echo
  echo "***********************************************"
  echo "* Compiling YouCompleteMe ... please wait ... *"
  echo "***********************************************"
  echo
  echo

  cd home/.vim/bundle/YouCompleteMe
  ./install.sh
  cd ../../../../
fi

echo
echo "Changes in Submodules ..."
echo "-------------------------"
echo
git log -1 -p --oneline | grep "+++" | sed "s/^.*bundle\///"
